<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SG Condo ROI – quick search</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5"></script>
<style>
body{font-family:system-ui,-apple-system,sans-serif;margin:0;padding:2rem;background:#f8f9fa;color:#222}
h1{margin-top:0}
label{display:block;margin:.5rem 0 .25rem;font-weight:600}
input{padding:.4rem .6rem;font-size:1rem;width:100%;max-width:200px}
#results{margin-top:1.5rem}
table{border-collapse:collapse;width:100%;max-width:800px;margin-top:.5rem}
th,td{border:1px solid #ccc;padding:.35rem .6rem;text-align:left}
th{background:#007bff;color:#fff}
tr:nth-child(even){background:#eef2f8}
</style>
</head>
<body>
<h1>Quick Condo Search</h1>

<label> Desired size (sqm)
  <input id="size" type="number" step="1" value="60">
</label>

<label> Max price (SGD)
  <input id="price" type="number" step="10000" value="800000">
</label>

<button id="btn">Search</button>

<div id="results"></div>

<script>
const CSV_PATH = "pmi_roi_agg.csv";   // adjust if the CSV lives elsewhere
let ROWS = [];

fetch(CSV_PATH)
  .then(r => r.text())
  .then(t => {
      const {data} = Papa.parse(t,{header:true,dynamicTyping:true,skipEmptyLines:true});
      ROWS = data.filter(r => r.project && r.most_recent_buy);
      document.getElementById('btn').disabled = false;
  })
  .catch(err => document.getElementById('results').textContent =
        "Failed to load CSV: "+err);

document.getElementById('btn').onclick = () => {
  const size   = +document.getElementById('size').value;
  const budget = +document.getElementById('price').value;

  // helper:  "50-60" → [50,60]   ">300" → [300, Infinity]
  const bucketRange = b => {
    if (!b) return [NaN,NaN];
    if (b.startsWith(">")) return [+b.slice(1), Infinity];
    const [lo,hi] = b.split("-").map(Number);
    return [lo,hi];
  };

  const matches = ROWS.filter(r => {
      const [lo,hi] = bucketRange(r.area_bucket);
      return lo<=size && size<=hi && r.most_recent_buy<=budget;
  });

  // render
  const out = document.getElementById('results');
  if (!matches.length) { out.textContent = "No matching units."; return; }

  let html = `<p>Found ${matches.length} matching units:</p><table><thead>
      <tr><th>Project</th><th>Size bucket</th><th>Last buy&nbsp;price</th><th>ROI&nbsp;%</th></tr></thead><tbody>`;

  matches.slice(0,100).forEach(r => {
      html += `<tr>
         <td>${r.project}</td>
         <td>${r.area_bucket}</td>
         <td>${Number(r.most_recent_buy).toLocaleString()}</td>
         <td>${r.ROI!=null ? Number(r.ROI).toFixed(2) : ""}</td>
      </tr>`;
  });
  html += "</tbody></table>";
  out.innerHTML = html;
};
</script>
</body>
</html>
