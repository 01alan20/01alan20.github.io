<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Condo quick search</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5"></script>
<style>
body{font-family:system-ui,-apple-system,sans-serif;margin:0;padding:2rem;background:#f8f9fa;color:#222}
h1{margin-top:0} label{display:block;margin:.6rem 0 .25rem;font-weight:600}
select,input{padding:.4rem .6rem;font-size:1rem;width:100%;max-width:220px}
button{margin-top:.7rem;padding:.45rem .9rem;font-size:1rem}
#results{margin-top:1.6rem}
table{border-collapse:collapse;width:100%;max-width:820px;margin-top:.8rem}
th,td{border:1px solid #ccc;padding:.35rem .6rem;text-align:left}
th{background:#007bff;color:#fff} tr:nth-child(even){background:#eef2f8}
</style>
</head>
<body>

<h1>Quick Condo Search</h1>

<label> Size bucket
  <select id="bucket" disabled><option>Loading…</option></select>
</label>

<label> Max price (SGD)
  <input id="price" type="number" step="10000" value="800000">
</label>

<button id="btn" disabled>Search</button>

<div id="results"></div>

<script>
const CSV_PATH = "pmi_roi_agg.csv";      // file sits in same folder
let ROWS = [], COL = {};

/* ---- 1  fetch & parse CSV ---- */
fetch(CSV_PATH)
  .then(r => r.text())
  .then(txt => {
     /* If your CSV is semicolon-delimited, add delimiter:";" */
     const {data} = Papa.parse(txt,{
         header:true, dynamicTyping:true, skipEmptyLines:true
     });
     if(!data.length){ show("CSV parsed 0 rows – wrong delimiter?"); return; }

     // detect real header names (case-insensitive)
     const hdr = n => Object.keys(data[0]).find(k=>k.toLowerCase()===n);
     COL.project = hdr("project");        // "Project" in your file
     COL.bucket  = hdr("area_bucket");    // "area_bucket"
     COL.price   = Object.keys(data[0]).find(k=>k.toLowerCase().includes("most_recent_buy"));
     COL.roi     = hdr("roi");

     if(!COL.project||!COL.bucket||!COL.price){
        show("Cannot find expected columns in CSV."); return;
     }

     ROWS = data.filter(r => r[COL.project] && r[COL.price]);

     // fill dropdown with unique buckets
     const buckets = [...new Set(ROWS.map(r=>r[COL.bucket]))]
                    .sort((a,b)=>parseFloat(a)-parseFloat(b));
     const sel = document.getElementById('bucket');
     sel.innerHTML = buckets.map(b=>`<option value="${b}">${b}</option>`).join("");
     sel.disabled = false;
     document.getElementById('btn').disabled = false;
  })
  .catch(err => show("Failed to load CSV: "+err));

/* ---- 2  helper ---- */
function range(bucket){
  if(bucket.startsWith(">")) return [+bucket.slice(1), Infinity];
  const [lo,hi]=bucket.split("-").map(Number); return [lo,hi];
}
function show(msg){ document.getElementById('results').textContent = msg; }

/* ---- 3  search ---- */
document.getElementById('btn').onclick = ()=>{
  const bucket = docu
